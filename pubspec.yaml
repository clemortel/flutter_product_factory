name: flutter_product_factory
publish_to: none

environment:
  sdk: ^3.8.0

workspace:
  - packages/foundation/factory_core
  - packages/platform/factory_platform_interface
  - packages/platform/factory_http
  - packages/platform/factory_storage
  - packages/platform/factory_analytics
  - packages/ui/factory_ui
  - packages/features/feature_counter
  - packages/widgetbook/factory_widgetbook
  - apps/demo_app

dev_dependencies:
  melos: ^7.0.0

melos:
  name: flutter_product_factory

  scripts:
    analyze:
      description: Run dart analyze on all packages
      run: dart analyze --fatal-infos
      exec:
        concurrency: 8

    test:
      description: Run all tests (Dart + Flutter)
      steps:
        - test:dart
        - test:flutter

    test:dart:
      description: Run tests in pure-Dart packages
      run: dart test
      exec:
        concurrency: 8
      packageFilters:
        dirExists: test
        noDependsOn: flutter

    test:flutter:
      description: Run tests in Flutter packages
      run: flutter test
      exec:
        concurrency: 4
      packageFilters:
        dirExists: test
        dependsOn: flutter

    build_runner:
      description: Run build_runner in packages that need code generation
      run: dart run build_runner build --delete-conflicting-outputs
      exec:
        concurrency: 1
      packageFilters:
        dependsOn: build_runner

    build_runner:watch:
      description: Watch mode for code generation
      run: dart run build_runner watch --delete-conflicting-outputs
      exec:
        concurrency: 1
      packageFilters:
        dependsOn: build_runner

    build_runner:clean:
      description: Clean generated files
      run: dart run build_runner clean
      exec:
        concurrency: 4
      packageFilters:
        dependsOn: build_runner
